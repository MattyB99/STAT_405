---
title: "Your Project Title"
author: "Group members"
output: pdf_document
#output: html_document
fontsize: 10pt
geometry: margin=1in
---

```{r setup, include=FALSE}
library(ggmap)
library(rgdal)
library(here)
library(proj4)
library(magrittr)
library(dplyr)
library(ggplot2)
library(cowplot)
library(magick)
library(png)
library(ggimage)
library(mapdeck)
library(usethis)
library(osmdata)
library(maps)
library(sf)
```

## cleaning data

```{r cleanup, eval=FALSE, include=FALSE}
#will not run with eval = FALSE
locs <- Parking_Citations%>%filter(!is.na(Latitude), !is.na(Fine.amount), Latitude > 99999)%>%select(Latitude, Longitude, Ticket.number)
coordinates(locs) <- ~ Latitude + Longitude
proj4string(locs) <- CRS("+init=esri:102645")
locs <- spTransform(locs, CRS("+init=epsg:4326"))%>%as.data.frame()%>%filter(Latitude < 0)%>%select(real_lng = Latitude, real_lat = Longitude, Ticket.number = Ticket.number)
df <- Parking_Citations%>%filter(!is.na(Latitude), !is.na(Fine.amount), Latitude > 99999)%>%
  left_join(LA_Weather%>%transmute(Issue.Date = format(as.Date(DATE, format = "%m/%d/%Y"), format = "%m/%d/%Y"), PRCP = PRCP, TAVG = TAVG))%>%
  left_join(locs)
saveRDS(df, file = "Parking_Citations_Cleaned.rds")
```

```{r}

## Creates locations and a heatmap of data on the map of LA
locs <- Parking_Citations %>%
  filter(!is.na(Latitude), Latitude > 99999) %>%
  select(Latitude, Longitude)
coordinates(locs) <- ~ Latitude + Longitude
proj4string(locs) <- CRS("+init=esri:102645")
locs <- spTransform(locs,CRS("+init=epsg:4326")) %>%
  as.data.frame()
locs2 <- locs[seq(4000000:4100000),]

map <- get_map(getbb("Los Angeles"), zoom = 10, map_type = "roadmap")
ggmap(map) + ## geom_point(aes(x = Latitude, y = Longitude), data = locs2, size = .5, alpha = .05, color = "red") 
  stat_density2d(data = locs2, aes(x = Latitude, y = Longitude, fill = ..level.., alpha = ..level..),
               geom = "polygon", size = 0.01, bins = 16) +
  scale_fill_gradient(low = "red", high = "yellow") +
  scale_alpha(range = c(0, 1), guide = FALSE)
```

```{r}
#Average fine amount by car Color
Parking_Citations[1:1000, 1:22] %>% 
  filter(!is.na(Fine.amount), !is.na(Color)) %>%
  group_by(Color) %>%
  summarise(avg = mean(Fine.amount), count = n()) %>%
  subset(Color == "RD" | Color == "GY" | Color =="WH" | Color == "BL" | Color == "BK" | Color == "BN") %>% 
  transmute(Color = Color, avg = avg) %>%
  ggplot() + aes(x = Color, y = avg) + geom_histogram(stat = "identity") +
  theme(axis.text.x.bottom = element_text(hjust = 1, angle = 45, size = 8)) +
  scale_fill_manual(values = c("Red", "Gray", "White", "Blue", "Black", "Brown"))
```
```